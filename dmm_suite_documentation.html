<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<meta http-equiv="Content-Script-Type" content="text:javascript" />
<title></title>
</head>
<body style="font-family: georgia;">
<h1>dmm_suite version 1.1</h1>
<div style="width: 80%; padding-left: 2em;">
<h2>Specification</h2>
<ul>
	<li>Released January 30th, 2011.</li>
	<li>Defines the object dmp_suite<ul>
		<li>Provides the proc load_dmp()<ul>
			<li>Loads the specified map file onto the specified z-level.</li>
			</ul></li>
		<li>Provides the proc write_map()<ul>
			<li>Returns a text string of the map in dmp format
				ready for output to a file.</li>
			</ul></li>
		<li>Provides the proc save_map()<ul>
			<li>Returns a .dmp file if map is saved</li>
			<li>Returns FALSE if map fails to save</li>
			<li>Automatically Saves the .dmp file in the world's directory<ul>
				<li>Note: Because of this behavior, save_map() is being phased out, it is suggested that you use write_map() instead.
				</li></ul>
			</ul></li>
		</ul></li>
	</ul>
<p>The dmm_suite provides saving and loading of map files in BYOND's native DMM map
format. It approximates the map saving and loading processes of the Dream Maker
and Dream Seeker programs so as to allow editing, saving, and loading of maps at
runtime.</p>
<hr />
<h2>Usage Notes</h2>
<h3>Saving Maps</h3>
<p>
	To save a map at runtime, create an instance of the dmm_suite, and then call write_map(), which accepts three arguments:
	<ul>
		<li>A turf representing one corner of a three dimensional grid (Required).</li>
		<li>Another turf representing the other corner of the same grid (Required).</li>
		<li>Any, or a combination, of several bit flags (Optional):<ul>
			<li>DMM_IGNORE_AREAS   : the writer will write all turfs as contained in world.area</li>
			<li>DMM_IGNORE_TURFS   : grid locations will be filled with the world.turf typepath</li>
			<li>DMM_IGNORE_OBJS    : objects will not be saved</li>
			<li>DMM_IGNORE_MOBS    : mobs will not be saved.<ul>
				<li>Note: DMM_IGNORE_MOBS == DMM_IGNORE_PLAYERS & DMM_IGNORE_NPCS</li>
				</ul></li>
			<li>DMM_IGNORE_PLAYERS : mobs with attached clients will not be saved</li>
			<li>DMM_IGNORE_NPCS    : mobs without attached clients will not be saved</li>
			</ul></li>
		</ul>
	The order in which the turfs are supplied does not matter, the /dmp_writer will determine the grid containing both, in much the same way as DM's block() function. write_map() returns a text string representing the map in dmp format, which can then be output to a file:
<code><pre>
	var/dmp_file = file("my_map.dmp")
	dmp_file << write_map(turf1, turf2, DMP_IGNORE_PLAYERS)
	</pre></code>
	</p>
<h3>Loading Maps</h3>
<p>
	To load a map at runtime, create an instance of /dmm_suite, and then call load_map(), which accepts two arguments:
	<ul>
		<li>A .dmm file to load (Required).</li>
		<li>A number representing the z-level on which to start loading the map (Optional).</li>
		</ul>
	The /dmm_suite will load the map file starting on the specified z-level. If no z-level	was specified, world.maxz will be increased so as to fit the map. Note that if you wish to load a map onto a z-level that already has objects on it, you will have to handle the removal of those objects. Otherwise the new map will simply load the new objects on top of the old ones.
	<br /> <br />
	Also note that all type paths specified in the .dmm file must exist in the world's code, and that the /dmm_reader trusts that files to be loaded are in fact valid .dmm files. Errors in the .dmm format will cause runtime errors.
	</p>
<hr />
<h2>Version History</h2><ul>
	<li>1.1<ul>
		<li>Released January 30th, 2011</li>
		<li>Combined the /dmp_reader and /dmp_writer libraries, and rebranded as the dmm_suite.</li>
		<li>Added an extra argument to the load_map() proc so as to allow maps to be loaded on any z-level.</li>
		</ul></li>
	</ul>
<hr />
<br />
<br />
</div>
</body>
</html>
